<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tablero de Ajedrez Interactivo - Versión Definitiva</title>
    <!-- Solo cargamos la librería de reglas. No se necesita JQuery ni librerías de tablero visual. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Playfair+Display:wght@700&family=Noto+Serif:ital,wght@0,400;0,700;1,400&display=swap');
        
        body { font-family: 'Noto Serif', serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 20px 0; background-color: #f0f0f0; color: #333; }
        
        /* Contenedor del Tablero */
        #board-container {
            width: 80vw; 
            max-width: 500px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            border: 8px solid #3A3836;
        }
        .chessboard {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            border: 1px solid #333;
        }
        .square {
            width: 12.5%; /* 100% / 8 */
            padding-bottom: 12.5%; /* Esto crea casillas cuadradas */
            position: relative;
        }
        .square .piece {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em; /* Ajusta el tamaño de las piezas de texto */
            color: #000;
        }
        .light { background-color: #f0d9b5; }
        .dark { background-color: #b58863; }
        .white-piece { /* Para las piezas blancas, borde negro */
             text-shadow: -1px -1px 0 #FFF, 1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF;
        }

        /* Controles */
        .controls { margin-top: 20px; }
        button { font-size: 1.2em; padding: 10px 15px; margin: 5px; cursor: pointer; border-radius: 5px; border: 2px solid #005f73; }
        button:hover { background-color: #005f73; color: white; }
        button:disabled { background-color: #ccc; border-color: #ccc; cursor: not-allowed; }
        #commentary { margin-top: 15px; padding: 10px; background-color: #e7e7e7; border-radius: 5px; min-height: 40px; text-align: center; width: 80%; max-width: 480px; font-style: italic; }
    </style>
</head>
<body>

    <h1>Tablero Interactivo con Caracteres de Texto</h1>
    <p>Este tablero no depende de imágenes externas y funcionará en cualquier navegador.</p>

    <div id="board-container"></div>
    
    <div class="controls">
        <button id="startBtn">« Inicio</button>
        <button id="prevBtn">‹ Ant.</button>
        <button id="nextBtn">Sig. ›</button>
        <button id="endBtn">Fin »</button>
    </div>

    <div id="commentary">¡Usa los botones para comenzar!</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    
    // --- LÓGICA DE AJEDREZ ---
    const game = new Chess();
    const pgn = `[Event "Prueba"]
[Site "Online"]
[Result "1-0"]
1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 a6 1-0`;
    
    const comments = {
        1: "Comentario para la jugada 1.",
        6: "Las negras juegan la variante Najdorf de la Siciliana."
    };
    
    game.load_pgn(pgn);
    const history = game.history({ verbose: true });
    let currentMoveIndex = -1;

    // --- REPRESENTACIÓN VISUAL DEL TABLERO ---
    const pieceUnicode = {
        p: '♙', r: '♖', n: '♘', b: '♗', q: '♕', k: '♔', // Blancas
        P: '♟', R: '♜', N: '♞', B: '♝', Q: '♛', K: '♚'  // Negras
    };
    
    const boardContainer = document.getElementById('board-container');
    
    function drawBoard() {
        const boardState = game.board(); // Obtiene el estado actual del tablero
        let boardHtml = '<div class="chessboard">';
        
        for (let i = 0; i < 8; i++) {
            for (let j = 0; j < 8; j++) {
                const squareColor = (i + j) % 2 === 0 ? 'light' : 'dark';
                let pieceHtml = '';
                const piece = boardState[i][j]; // {type: 'p', color: 'w'}
                if (piece) {
                    const pieceSymbol = pieceUnicode[piece.color === 'b' ? piece.type.toUpperCase() : piece.type];
                    const pieceColorClass = piece.color === 'w' ? 'white-piece' : '';
                    pieceHtml = `<span class="piece ${pieceColorClass}">${pieceSymbol}</span>`;
                }
                boardHtml += `<div class="square ${squareColor}">${pieceHtml}</div>`;
            }
        }
        boardHtml += '</div>';
        boardContainer.innerHTML = boardHtml;
    }

    // --- LÓGICA DE NAVEGACIÓN Y ACTUALIZACIÓN ---
    function updateDisplay() {
        drawBoard();
        let comment = "¡Usa los botones para comenzar!";
        if (currentMoveIndex > -1) {
            const moveNumber = Math.floor(currentMoveIndex / 2) + 1;
            comment = comments[moveNumber] || `Movimiento ${moveNumber}: ${history[currentMoveIndex].san}`;
        }
        document.getElementById('commentary').innerText = comment;

        // Habilitar/deshabilitar botones
        document.getElementById("startBtn").disabled = currentMoveIndex <= -1;
        document.getElementById("prevBtn").disabled = currentMoveIndex <= -1;
        document.getElementById("nextBtn").disabled = currentMoveIndex >= history.length - 1;
        document.getElementById("endBtn").disabled = currentMoveIndex >= history.length - 1;
    }

    // Lógica de los botones
    document.getElementById("startBtn").onclick = () => {
        currentMoveIndex = -1;
        game.reset();
        updateDisplay();
    };
    document.getElementById("prevBtn").onclick = () => {
        if (currentMoveIndex > -1) {
            currentMoveIndex--;
            game.undo();
            updateDisplay();
        }
    };
    document.getElementById("nextBtn").onclick = () => {
        if (currentMoveIndex < history.length - 1) {
            currentMoveIndex++;
            game.move(history[currentMoveIndex].san);
            updateDisplay();
        }
    };
    document.getElementById("endBtn").onclick = () => {
        currentMoveIndex = history.length - 1;
        game.load_pgn(pgn); // Asegura que estemos al final
        updateDisplay();
    };

    // Estado inicial
    updateDisplay();
});
</script>

</body>
</html>
