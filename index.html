<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Tablero de Ajedrez Interactivo - Base Funcional</title>
    
    <!-- ENLACES CORREGIDOS: TODOS USAN HTTPS Y PROVIENEN DE CDN's ESTABLES -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 20px 0;
            background-color: #f0f0f0;
        }
        #board-container {
            width: 80vw; 
            max-width: 500px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .controls {
            margin-top: 20px;
        }
        button {
            font-size: 1.2em;
            padding: 10px 15px;
            margin: 5px;
            cursor: pointer;
        }
        #commentary {
            margin-top: 15px;
            padding: 10px;
            background-color: #e7e7e7;
            border-radius: 5px;
            min-height: 40px;
            text-align: center;
            width: 80%;
            max-width: 480px;
            font-style: italic;
        }
    </style>
</head>
<body>

    <h1>Prueba de Tablero Interactivo</h1>
    <p>Si ves las piezas y los botones funcionan, ¡lo hemos logrado!</p>

    <div id="board-container"></div>
    
    <div class="controls">
        <button id="startBtn">« Inicio</button>
        <button id="prevBtn">‹ Ant.</button>
        <button id="nextBtn">Sig. ›</button>
        <button id="endBtn">Fin »</button>
    </div>

    <div id="commentary">¡Usa los botones para comenzar!</div>

<script>
$(document).ready(function() {
    var board = null;
    var game = new Chess();
    var pgn = `[Event "Prueba"]
[Site "Online"]
[White "Jugador Blanco"]
[Black "Jugador Negro"]
[Result "1-0"]

1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 a6 {Comentario para el movimiento 6 de las negras} 1-0`;
    
    var comments = {
        1: "Comentario para la jugada 1.",
        6: "Las negras juegan la variante Najdorf de la Siciliana."
    };
    
    game.load_pgn(pgn);
    var history = game.history({ verbose: true }); // Obtener historial detallado
    var currentMoveIndex = -1;

    // Función que actualiza todo
    function updateDisplay() {
        var moveNumber = Math.floor(currentMoveIndex / 2) + 1;

        if (currentMoveIndex === -1) {
            $('#commentary').text("¡Usa los botones para comenzar!");
        } else if (comments[moveNumber]) {
            $('#commentary').text(`Jugada ${moveNumber}: ${comments[moveNumber]}`);
        } else {
            $('#commentary').text(`Movimiento ${moveNumber}: ${history[currentMoveIndex].san}`);
        }

        // Habilitar o deshabilitar botones
        $('#startBtn').prop('disabled', currentMoveIndex <= -1);
        $('#prevBtn').prop('disabled', currentMoveIndex <= -1);
        $('#nextBtn').prop('disabled', currentMoveIndex >= history.length - 1);
        $('#endBtn').prop('disabled', currentMoveIndex >= history.length - 1);
    }
    
    // Configuración del tablero
    var config = {
      position: 'start',
      // Este es el enlace seguro (HTTPS) y estable que SÍ funcionará
      pieceTheme: 'https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/img/chesspieces/wikipedia/{piece}.png'
    };
    board = Chessboard('board-container', config);
    
    // Botones
    $('#startBtn').on('click', function () {
        currentMoveIndex = -1;
        game.reset();
        board.position('start');
        updateDisplay();
    });

    $('#prevBtn').on('click', function () {
        if (currentMoveIndex > -1) {
            currentMoveIndex--;
            game.undo();
            board.position(game.fen());
            updateDisplay();
        }
    });

    $('#nextBtn').on('click', function () {
        if (currentMoveIndex < history.length - 1) {
            currentMoveIndex++;
            game.move(history[currentMoveIndex].san); // Usamos .san del historial detallado
            board.position(game.fen());
            updateDisplay();
        }
    });

    $('#endBtn').on('click', function () {
        game.load_pgn(pgn);
        board.position(game.fen());
        currentMoveIndex = history.length - 1;
        updateDisplay();
    });

    // Estado inicial
    updateDisplay();
});
</script>

</body>
</html>
